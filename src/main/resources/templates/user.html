<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <title>My Profile</title> <!-- Page title -->
    <link href="static/css/style.css" rel="stylesheet" th:href="@{../css/style.css}" type="text/css">
    <link href="static/css/rating.css" media="all" rel="stylesheet" th:href="@{~/css/rating.css}" type="text/css">
    <meta content-type="width=device-width initial-scale=1" name="viewport">
    <meta charset="utf-8">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
</head>
<body>
<h3 style="color: green" th:if="${param.updated}">Profile Updated!</h3>
<h3 style="color: orange" th:if="${param.banned}">User Banned!</h3>
<h3 style="color: orange" th:if="${param.promoted}">User Promoted!</h3>
<section class="login-block">
    <div class="container user-profile">
        <br>
        <div class="row">
            <div class="col-md-4">
                <div>
                    <img alt="User Picture" class="user-image"
                         th:src="'data:image/*;base64,' + ${user.getImageAsString()}">
                </div>
                <br>
            </div>
            <div class="col-md-8">
                <div class="user-details-body">
                    <h6 class="user-details">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item">First Name: <span><b th:text="${user.firstName}"/></span></li>
                            <li class="list-group-item">Last Name: <span><b th:text="${user.lastName}"/></span></li>
                            <li class="list-group-item">Nickname: <span><b th:text="${user.nickname}"/></span></li>
                            <li class="list-group-item">E-mail: <span><b th:text="${user.email}"/></span></li>
                            <li class="list-group-item">Location: <span><b th:text="${user.location}"/></span></li>
                        </ul>
                    </h6>
                    <p>
                        <a button class="btn btn-secondary" th:href="@{/}">Home Page</a>
                        <a button class="btn btn-success" th:href="@{/addBook}"
                           th:if="${user.email.equals(principal.name)}">Add Book</a>
                        <a button class="btn btn-primary" th:href="@{/user/editProfile}"
                           th:if="${user.email.equals(principal.name)}">Edit Profile</a>
                        <a button class="btn btn-primary"
                           sec:authorize="hasRole('ROLE_ADMIN')" th:href="@{/export-users}" th:if="${user.email.equals(principal.name)}">Download User CSV</a>
                        <a button class="btn btn-primary"
                           sec:authorize="hasRole('ROLE_ADMIN')" th:href="@{/export-books}" th:if="${user.email.equals(principal.name)}">Download Books CSV</a>
                        <button class="btn btn-danger" sec:authorize="hasAnyRole('ROLE_ADMIN','ROLE_MODERATOR')"
                                th:if="${not user.email.equals(principal.name)}"
                                th:onclick="|window.location.href='/user/ban/${user.id}'|">Ban User
                        </button>
                        <button class="btn btn-danger" sec:authorize="hasRole('ROLE_ADMIN')"
                                th:if="${not user.email.equals(principal.name)}"
                                th:onclick="|window.location.href='/user/${user.id}/promote'|">Promote User
                        </button>
                    </p>
                </div>
                <p class="alert alert-success text-center" th:if="${param.sent}">Your message has been sent!</p>

            </div>
        </div>
        <br>
        <table class="table table-striped table-hover">
            <thead th:if="${not books.isEmpty()}">
            <tr class="table-info">
                <th>Book Name</th>
                <th>Author</th>
                <th>For Rent</th>
                <th>Rent Price</th>
                <th>For Sale</th>
                <th>Sale Price</th>
                <th>Rating</th>
                <th>Action</th>
            </tr>
            </thead>
            <tbody>
            <th:block th:each="book : ${books}">
                <tr class="table-warning">
                    <td><a style="color: #000;" th:href="@{/bookDetails/{id}(id=${book.id})}"><b
                            th:text="${book.bookName}" data-placement="bottom" data-toggle="tooltip" title="Book Details"></b></a></td>
                    <td th:text="${book.authorName}"></td>
                    <td th:text="${book.bookRent} ? 'YES' : 'NO'"></td>
                    <td th:text="${book.bookRent} ? ${book.rentPrice} : ' '"></td>
                    <td th:text="${book.bookSale} ? 'YES' : 'NO'"></td>
                    <td th:text="${book.bookSale} ? ${book.sellPrice} : ' '"></td>
                    <td>
                        <th:block th:switch="${book.rating}">
                            <div th:case="5"><span class="stars-container stars-100">★★★★★</span></div>
                            <div th:case="4"><span class="stars-container stars-80">★★★★★</span></div>
                            <div th:case="3"><span class="stars-container stars-60">★★★★★</span></div>
                            <div th:case="2"><span class="stars-container stars-40">★★★★★</span></div>
                            <div th:case="1"><span class="stars-container stars-20">★★★★★</span></div>
                            <div th:case="0"><span class="stars-container stars-0">★★★★★</span></div>
                        </th:block>
                    </td>
                    <td><a data-placement="bottom" data-toggle="tooltip" title="Edit Book"
                           th:href="@{/editBook/{id}(id=${book.id})}"
                           th:if="${user.email.equals(principal.name)}" ><i class="fa fa-edit" style="color: #000;"></i></a></td>
                </tr>
            </th:block>
            </tbody>
        </table>
        <br>
    </div>
</section>
<!--Footer -->
<div id="footer">
    <div class="card img-fluid" style="width:1600px">
        <div class="card-img-overlay">
            <div class="text-right" style="margin-bottom:0">
                <h6>Bookworms Community</h6>
                <p>&copy; Copyright AIRS 2019 All Rights Reserved.</p>
            </div>
        </div>
    </div>
</div>
</body>
</html>